<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: head('User Profile')"></head>

<body>
<div th:replace="fragments/navbar :: navbar"></div>
<div class="container full-width">
    <h1>User Profile</h1>

    <!-- Guest view -->
    <div id = "guest_view" th:if="${isAuthenticated != true}" class="alert">
        You are viewing as guest.
        <a th:href="@{/login}">Login</a> or <a th:href="@{/signup}">Sign up</a>.
    </div>

    <!-- Authenticated view -->
    <div id = "authenticated" th:if="${isAuthenticated == true}">
        <!-- User Info -->
        <div id = "user_info" class="perk-card">
            <strong>Username:</strong> <span th:text="${account.username}">username</span>
        </div>


        <div class="profile-section">
            <!-- Membership Section -->
            <div class="profile-column">
                <h2>Linked Memberships</h2>
                <div th:if="${#lists.isEmpty(memberships)}">
                    <div class="perk-card">No memberships linked.</div>
                </div>
                <div th:each="m : ${memberships}" class="perk-card profile-item">
                    <div>
                        <span th:text="${m.type}">Type</span> -
                        <span th:text="${m.organizationName}">Organization</span>
                    </div>
                    <form class="flat-form" th:action="@{/profile/memberships/remove}" method="post">
                        <input type="hidden" name="membershipId" th:value="${m.id}" />
                        <button class="btn-small" type="submit">Remove</button>
                    </form>
                </div>
                <form th:action="@{/memberships}" method="get">
                    <div class="actions">
                        <button type="submit" class="btn-primary">Get More Memberships</button>
                    </div>
                </form>
            </div>

            <!-- Perk Section -->
            <div class="profile-column">
                <h2>Linked Perks</h2>
                <div th:if="${#lists.isEmpty(perks)}">
                    <div class="perk-card">No perks linked.</div>
                </div>
                <div th:each="p : ${perks}" class="perk-card profile-item">
                    <div>
                        <span th:text="${p.benefit}">Benefit</span>
                        <span th:if="${p.membership != null}">
                            -
                            <span th:text="${p.membership.organizationName}">Organization</span>
                        </span>
                    </div>
                    <form class="flat-form" th:action="@{/profile/perks/remove}" method="post">
                        <input type="hidden" name="perkId" th:value="${p.id}" />
                        <button class="btn-small" type="submit">Remove</button>
                    </form>
                </div>
                <form th:action="@{/perks}" method="get">
                    <div class="actions">
                        <button type="submit" class="btn-primary">Get More Perks</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div th:replace="fragments/footer :: footer"></div>
</body>
</html>
