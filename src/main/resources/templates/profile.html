<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: head('User Profile')"></head>

<body>
<div th:replace="fragments/navbar :: navbar"></div>
<div class="container full-width">
    <h1>User Profile</h1>

    <!-- Guest view -->
    <div th:if="${isAuthenticated != true}" class="alert">
        You are viewing as guest.
        <a th:href="@{/login}">Login</a> or <a th:href="@{/signup}">Sign up</a>.
    </div>

    <!-- Authenticated view -->
    <div th:if="${isAuthenticated == true}">
        <!-- User Info -->
        <div class="perk-card">
            <strong>Username:</strong> <span th:text="${account.username}">username</span>
        </div>

        <!-- Membership Section -->
        <div class="profile-section">
            <!-- Linked Memberships Column -->
            <div class="profile-column">
                <h2>Linked Memberships</h2>
                <div th:if="${#lists.isEmpty(memberships)}">
                    <div class="perk-card">No memberships linked.</div>
                </div>
                <div th:each="m : ${memberships}" class="perk-card profile-item">
                    <div>
                        <span th:text="${m.type}">Type</span> -
                        <span th:text="${m.organizationName}">Organization</span>
                    </div>
                    <form class="flat-form" th:action="@{/profile/memberships/remove}" method="post">
                        <input type="hidden" name="membershipId" th:value="${m.id}" />
                        <button class="btn-small" type="submit">Remove</button>
                    </form>
                </div>
            </div>

            <!-- Add Membership Column -->
            <div class="profile-column">
                <h2>Add Membership</h2>
                <form th:action="@{/profile/memberships/add}" method="post" class="profile-form">
                    <select name="membershipId" required>
                        <option value="" disabled selected>-- Select a membership --</option>
                        <option th:each="m : ${allMemberships}"
                                th:value="${m.id}"
                                th:text="${m.type} + ' - ' + ${m.organizationName}">
                        </option>
                    </select>
                    <div class="actions">
                        <button type="submit" class="btn-primary">Add</button>
                    </div>
                </form>
            </div>
        </div>
        <!-- Perk Section -->
        <div class="profile-section">
            <div class="profile-column">
                <h2>Linked Perks</h2>
                <div th:if="${#lists.isEmpty(perks)}">
                    <div class="perk-card">No perks linked.</div>
                </div>
                <div th:each="p : ${perks}" class="perk-card profile-item">
                    <div>
                        <span th:text="${p.benefit}">Benefit</span>
                        <span th:if="${p.membership != null}">
                            -
                            <span th:text="${p.membership.organizationName}">Organization</span>
                        </span>
                    </div>
                    <form class="flat-form" th:action="@{/profile/perks/remove}" method="post">
                        <input type="hidden" name="perkId" th:value="${p.id}" />
                        <button class="btn-small" type="submit">Remove</button>
                    </form>
                </div>
            </div>

            <div class="profile-column">
                <h2>Add Perk</h2>
                <form th:action="@{/profile/perks/add}" method="post" class="profile-form">
                    <select name="perkId" required>
                        <option value="" disabled selected>-- Select a perk --</option>
                        <option th:each="p : ${allPerks}"
                                th:value="${p.id}"
                                th:text="${p.benefit}">
                        </option>
                    </select>
                    <div class="actions">
                        <button type="submit" class="btn-primary">Add</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div th:replace="fragments/footer :: footer"></div>
</body>
</html>
